[Rainmeter]
Update=30
AccurateText=1
RIghtMOuseUpAction=[!SkinCustomMenu]
ContextTitle=Refresh
ContextAction=[!Refresh]
ContextTitle2=Settings
ContextAction2=[!ActivateConfig "PowerToys+\@settings" "dashboard.ini"][!UpdateMeasure Unload]
SkinWidth=#GlobalW#
SkinHeight=#GlobalH#
OnRefreshAction=[!Setvariable SliderX ([MeasureWin7Audio:0]/100*#SliderW#+#SliderM#)][!UpdateMeter VolumeSlider][!WriteKeyValue #CURRENTCONFIG# Active 0 "%APPDATA%\Rainmeter\Rainmeter.ini"]


[Variables]
@includeCommon=resource\Common.inc
barhandler=2

VisualizerHeight=(130*#scale#)
VisualizerBarWidth=(20.5*#Scale#)
VisualizerBarGap=5
VisualizerCornerRounding=(4*#Corner#)

SliderM=(70*#Scale#)
SliderX=#SliderM#
SliderW=(200*#Scale#)
SliderH=(3*#Scale#)

MaxMeter=6
[SectionHeader]
text=Audio status
[WinIcon]
ImageName=#@#icons\#IconPack#\Sound.png

[Date]
StringAlign=Right
UpdateDivider=33

[MeasureTime]
UpdateDivider=33
[MeasureSec]
UpdateDivider=33

;///////////////////////////////////////////////////////////////////////////////////////////////////
;                                              content
;///////////////////////////////////////////////////////////////////////////////////////////////////

;;=====================================
;; vis                                                                                                  
;;=====================================

[VisualizerBackground]
Meter=shape
shape=Rectangle 0,0,(#GlobalW#-50*#scale#),(#VisualizerHeight#+20*#scale#),(5*#corner#),(5*#corner#) | StrokeWidth 0 | Fill Color #darkcolor#,(#alpha#*0.3)
X=(25*#scale#)
y=(50*#Scale#)r
container=container
UpdateDivider=-1


[VisualizerContent]
Meter=Shape
X=(35*#scale#)
y=(10*#scale#)r
Shape= Rectangle 0, #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand0])), #VisualizerCornerRounding# | Extend Style
Shape2=Rectangle (1*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand1])), #VisualizerCornerRounding# | Extend Style
Shape3=Rectangle (2*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand2])), #VisualizerCornerRounding# | Extend Style
Shape4=Rectangle (3*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand3])), #VisualizerCornerRounding# | Extend Style
Shape5=Rectangle (4*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand4])), #VisualizerCornerRounding# | Extend Style
Shape6=Rectangle (5*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand5])), #VisualizerCornerRounding# | Extend Style
Shape7=Rectangle (6*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand6])), #VisualizerCornerRounding# | Extend Style
Shape8=Rectangle (7*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand7])), #VisualizerCornerRounding# | Extend Style
Shape9=Rectangle (8*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand8])), #VisualizerCornerRounding# | Extend Style
Shape10=Rectangle (9*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand9])), #VisualizerCornerRounding# | Extend Style
Shape11=Rectangle (10*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand10])), #VisualizerCornerRounding# | Extend Style
Shape12=Rectangle (11*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand11])), #VisualizerCornerRounding# | Extend Style
Shape13=Rectangle (12*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand12])), #VisualizerCornerRounding# | Extend Style
Shape14=Rectangle (13*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand13])), #VisualizerCornerRounding# | Extend Style
Shape15=Rectangle (14*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand14])), #VisualizerCornerRounding# | Extend Style
Shape16=Rectangle (15*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand15])), #VisualizerCornerRounding# | Extend Style
Shape17=Rectangle (16*(#VisualizerBarWidth#+#VisualizerBarGap#)), #VisualizerHeight#, #VisualizerBarWidth#, (-1*(#VisualizerHeight#*[MeasureBand16])), #VisualizerCornerRounding# | Extend Style
Style=Fill Color #Darkcolor#,(#alpha#/2) | StrokeWidth 0
container=container
DynamicVariables=1

@IncludeVis=resource\Visualizer.inc

;;=====================================
;; Sound control                                                                                                  
;;=====================================

[Soundbisector]
Meter=Shape
Y=(25*#Scale#)R
MeterStyle=Bisector
Container=Container

[SoundControlHeader]
meter=string
x=(25*#scale#)
y=(15*#scale#)r
Text=Sound control
meterstyle=RegularText
fontweight=500
DynamicVariables=1

[SoundIcon]
Meter=Image
ImageTint=#FontColor#
X=(3*#Scale#)r
Y=(20*#Scale#)R
W=(20*#Scale#)
Container=Container
Imagename=
Group=VolumeElements

[VolumeSlider]
Meter=Shape
X=#SliderM#
Y=(8*#Scale#)r
Shape=Rectangle 0,0,#SliderW#,#SliderH#,(#Corner#),(#Corner#) | Fill Color #Border# | StrokeWidth 0
Shape2=Rectangle 0,0,(#SliderX#-#SliderM#),#SliderH#,(#Corner#),(#Corner#) | Fill Color #Accent# | StrokeWidth 0
Shape3=Ellipse (#SliderX#-#SliderM#),(#SliderH#/2),(8*#Scale#),(8*#Scale#) | Fill Color #Accent# | StrokeWidth 0
Shape4=Rectangle 0,(-#SliderH#*3),#SliderW#,(#SliderH#*6) | Fill Color 0,0,0,1 | StrokeWidth 0
LeftMouseDownAction=[!CommandMeasure MeasureMouse "Start"]
DynamicVariables=1
UpdateDivider=-1
Container=Container
Group=VolumeElements

[VolumeText]
Meter=String
X=(30*#Scale#+#SliderW#)r
Y=(#SliderH#/2)r
Text=[MeasureWin7Audio:0]
StringAlign=CenterCenter
UpdateDivider=-1
DynamicVariables=1
MeterStyle=RegularText
Container=Container
Group=VolumeElements

[VolumeDevice]
MEter=Shape
X=(#scale#*30)r
Y=r
UpdateDivider=-1
Shape=Rectangle 0,(-#scale#*20),(#scale#*150),(#scale#*40),(#Corner#*5),(#Corner#*5) | StrokeWidth 1 | Fill Color #DarkColor#,(#Alpha#*0.3) | Extend This
This=Stroke Color #BoxBorder#,(#Alpha#*0.5)
Container=Container
MouseOverAction=[!SetOption #CURRENTSECTION# This "Stroke Color #FontColor#,(#Alpha#*0.5)"][!UpdateMeter #CURRENTSECTION#][!Redraw]
MouseLeaveAction=[!SetOption #CURRENTSECTION# This "Stroke Color #BoxBorder#,(#Alpha#*0.5)"][!UpdateMeter #CURRENTSECTION#][!Redraw]
LeftMouseUpAction=[!CommandMeasure "MeasureWin7Audio" "TogglePrevious"][!refresh]
RightMouseUpAction=[!CommandMeasure "MeasureWin7Audio" "ToggleNext"][!refresh]
MiddleMouseUpAction=[!refresh]

[VolumeDeviceText]
Meter=String
X=(#scale#*150/2)r
Y=r
Measurename=MeasureWin7Audio
Text=%1
StringAlign=CenterCenter
UpdateDivider=-1
MeterStyle=RegularText
Container=Container
Group=VolumeElements

;;=====================================
;; App volume                                                                                                  
;;=====================================

[AppVolBisector]
Meter=Shape
Y=(20*#Scale#)R
MeterStyle=Bisector
Container=Container

[AppVolHeader]
meter=string
x=(25*#scale#)
y=(15*#scale#)r
Text=App volumes
meterstyle=RegularText
fontweight=500
DynamicVariables=1


;;=====================================
;; equalizer                                                                                                  
;;=====================================

[AppVolumeParent]
Measure=Plugin
Plugin=AppVolume
IgnoreSystemSound=0
ExcludeApp = rainmeter.exe;

[GeneratorScript]
Measure=Script
ScriptFile =resource\AudioLua.lua
IncFile    =resource\AudioMeasures.inc
MeasureName=AppVolumeParent
AutoRefresh=0
S1  =AppVol%%
S1K1=Measure=Plugin
S1K2=Plugin=AppVolume
S1K3=Parent=AppVolumeParent
S1K4=Index=%%
S1K5=Substitute=".exe":""
S2  =AppPeak%%
S2K1=Measure=Plugin
S2K2=Plugin=AppVolume
S2K3=Parent=AppVolumeParent
S2K4=Index=%%
S2K5=NumberType=Peak
S2K6=StringType=FilePath
S3  =MeterText%%
S3K1=Meter=String
S3K2=MeterStyle=TextStyle
S3K3=MeasureName=AppVol%%
S3K4=Y={((%% - 1) * 35 + 400)*#scale#}
S4  =MeterShape%%
S4K1=Meter=Shape
S4K2=MeterStyle=ShapeStyle
S4K3=PeakWidth=Scale ([AppPeak%%:] > 0 ? [AppPeak%%:] : 0), 1, 0, 0
S4K4=VolWidth=Scale ([AppVol%%:] > 0 ? [AppVol%%:] : 0), 1, 0, 0
S4K5=LeftMouseUpAction=!CommandMeasure AppVol%% "ToggleMute"
S4K6=MouseScrollUpAction=!CommandMeasure AppVol%% "SetVolume +5"
S4K7=MouseScrollDownAction=!CommandMeasure AppVol%% "SetVolume -5"

[ShapeStyle]
Y=r
X=(175*#scale#)
Shape =Rectangle 0, 0, 250, 20, 5 | StrokeWidth 0 | Fill Color #Darkcolor#,(#Alpha#*0.25)
Shape2=Rectangle 0, 0, 250, 20 | StrokeWidth 0 | Fill Color #Darkcolor#,(#Alpha#*0.25) | Extend VolWidth
Shape3=Rectangle 0, 0, 250,  5 | StrokeWidth 0 | Fill Color #Accent# | Extend PeakWidth
Shape4=Rectangle 0, 0, 250, 20, 5
Shape5=Combine Shape2 | Intersect Shape4
Shape6=Combine Shape3 | Intersect Shape4
ToolTipText=Click to toggle mute#CRLF#Scroll to change
container=container
DynamicVariables=1

[TextStyle]
X=(25*#scale#)
FontSize  =12
FontWeight=400
FontFace  =Cabliri
FontColor =D4D3CD
container=container
AntiAlias =1

@include=resource\AudioMeasures.inc


;///////////////////////////////////////////////////////////////////////////////////////////////////
;                                              Measures
;///////////////////////////////////////////////////////////////////////////////////////////////////


[MeasureWin7Audio]
Measure=Plugin
Plugin=Win7AudioPlugin
DynamicVariables=1
OnChangeAction=[!Setvariable SliderX ([MeasureWin7Audio:0]/100*#SliderW#+#SliderM#)][!UpdateMeterGroup VolumeElements][!Redraw]
IfCondition=MeasureWin7Audio < 1
IfTrueAction=[!SetOption SoundIcon ImageName "#@#Icons\#IconPack#\Sound0.png"][!UpdateMeter SoundIcon]
IfCondition2=(MeasureWin7Audio > 0) && (MeasureWin7Audio < 33)
IfTrueAction2=[!SetOption SoundIcon ImageName "#@#Icons\#IconPack#\Sound1.png"][!UpdateMeter SoundIcon]
IfCondition3=(MeasureWin7Audio > 32) && (MeasureWin7Audio < 81)
IfTrueAction3=[!SetOption SoundIcon ImageName "#@#Icons\#IconPack#\Sound2.png"][!UpdateMeter SoundIcon]
IfCondition4=MeasureWin7Audio > 80
IfTrueAction4=[!SetOption SoundIcon ImageName "#@#Icons\#IconPack#\Sound.png"][!UpdateMeter SoundIcon]

[SliderPercent]
Measure=Calc
Formula=((#SliderX#-(#SliderM#))*100/(((#SliderM#)+#SliderW#)-(#SliderM#)))
OnUpdateAction=[!CommandMeasure "MeasureWin7Audio" "SetVolume [#CURRENTSECTION#]"][!UpdateMeasure MeasureWin7Audio]
DynamicVariables=1
Disabled=1
Group=NoUpdateOnLoad
UpdateDivider=-1

[MeasureMouse]
Measure=Plugin
Plugin=Mouse
; this measure uses the Plugin:Mouse
LeftMouseDragAction=[!SetVariable SliderX "(Clamp(($MouseX$),(#SliderM#),((#SliderM#)+#SliderW#)))"][!UpdateMeasure SliderPercent][!UpdateMeterGroup VolumeElements][!Redraw]
; actions to be executed when the mouse drags. The first bang gets the mouse value and make sure it's in the slider. The bangs after that updates the required measures and the slider.
LeftMouseUpAction=[!CommandMeasure MeasureMouse "Stop"]
; actions to be executed after the mouse click is lifted. The first bang stops the measure to retrieve information from mouse dragging.
RelativeToSkin=1
RequireDragging=1
DynamicVariables=1
